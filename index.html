<script>
    const elements = [];
    const stepsContainer = document.getElementById("steps");

    function addElement() {
        const element = document.getElementById("element").value.trim();
        const percentage = parseFloat(document.getElementById("percentage").value);
        const molarMass = parseFloat(document.getElementById("molarMass").value);

        if (!element || isNaN(percentage) || isNaN(molarMass)) {
            alert("Please fill in all fields correctly!");
            return;
        }

        elements.push({ element, percentage, molarMass });
        updateSteps();
    }

    function updateSteps() {
        stepsContainer.innerHTML = "";

        const moleRatios = [];

        // Step 1: Calculate Moles
        const step1 = document.createElement("div");
        step1.innerHTML = `<strong>Step 1:</strong> Calculate moles for each element.`;
        elements.forEach(({ element, percentage, molarMass }) => {
            const moles = (percentage / molarMass).toFixed(2);
            moleRatios.push(parseFloat(moles));
            step1.innerHTML += `<br>${element}: ${percentage} / ${molarMass} = ${moles} moles`;
        });
        stepsContainer.appendChild(step1);

        // Step 2: Normalize Mole Ratios
        const smallestMole = Math.min(...moleRatios);
        const normalized = moleRatios.map(moles => moles / smallestMole);

        // Check for fractional values (e.g., 0.5) and handle them
        const needsAdjustment = normalized.some(ratio => (ratio % 1).toFixed(1) === "0.5");
        const adjustedNormalized = needsAdjustment
            ? normalized.map(ratio => ratio * 2)
            : normalized;

        const step2 = document.createElement("div");
        step2.innerHTML = `<strong>Step 2:</strong> Normalize the mole ratios.<br>`;
        adjustedNormalized.forEach((ratio, i) => {
            const displayRatio = ratio.toFixed(1);
            step2.innerHTML += `${elements[i].element}: ${moleRatios[i]} / ${smallestMole} = ${displayRatio}<br>`;
        });
        stepsContainer.appendChild(step2);

        // Step 3: Display Formula
        const formula = adjustedNormalized
            .map((ratio, i) => {
                const roundedRatio = Math.round(ratio);
                return roundedRatio === 1 ? elements[i].element : `${elements[i].element}${roundedRatio}`;
            })
            .join("");

        const step3 = document.createElement("div");
        step3.innerHTML = `<strong>Step 3:</strong> Empirical Formula: <strong>${formula}</strong>`;
        stepsContainer.appendChild(step3);
    }
</script>
